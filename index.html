function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSheet();
  const data = JSON.parse(e.postData.contents);

  const hours = data.totalMs / (1000 * 60 * 60);
  const earnings = hours * data.rate;

  sheet.appendRow([
    data.date,
    data.startTime,
    data.endTime,
    formatTime(data.totalMs),
    hours.toFixed(2),
    data.tasks,
    data.rate,
    earnings.toFixed(2)
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({ status: "saved" }))
    .setMimeType(ContentService.MimeType.JSON);
}

function formatTime(ms) {
  let s = Math.floor(ms / 1000);
  let h = Math.floor(s / 3600);
  let m = Math.floor((s % 3600) / 60);
  return `${pad(h)}:${pad(m)}`;
}

function pad(n) {
  return n.toString().padStart(2, "0");
}
